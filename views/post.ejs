<%-include("partials/header")-%>

<%if(typeof postDetail !== "undefined"){%>
        <h1>
                <%=postDetail.title%>
            </h1>
            <%if(typeof postDetail.publishedDate !== "undefined"){%>
                <span>Published <%=postDetail.publishedDate%></span>
            <%}%> 
            <%if(typeof postDetail.updatedDate !== "undefined"){%>
                <span>Updated <%=postDetail.updatedDate%></span>
            <%}%>   
            <br/>
            <% if(typeof postDetail.imageUrl !== "undefined"){%>
                <img src="/images/<%=postDetail.imageUrl%>" width="100rem">
            <%} else {%>
                <img src="/images/<%=postDetail.imageUrl%>" style="display:none" width="25rem">
            <%}%>
            <p><%if(typeof postDetail.category !== "undefined"){%>
                <span>Category: <%=postDetail.category%></span>
            <%}%> 
                <%=postDetail.content%>
            </p>
            <h2>Comments Below</h2>
           
                    <%const reversed = comments.reverse();%>
                        <%reversed.forEach(function(comments){%>
                            <hr/>
                            <div>
                                <%=comments.username%><br/>
                                <%if(typeof comments.publishedDate !== "undefined"){%>
                                    <span>Published <%=comments.publishedDate%></span>
                                <%}%> 
                                <%if(typeof comments.updatedDate !== "undefined"){%>
                                    <span>Updated <%=comments.updatedDate%></span>
                                <%}%>   
                                <br/>
                                <%=comments.comment%>
                                <h4>Edit Comment</h4>
                                <form action="/editComment/<%=postDetail._id%>" method="post" autocomplete="off">
                                    <input type="text" name="editedComment">
                                    <input type="hidden" name="commentId" value="<%=comments._id%>">
                                    <button type="submit">Edit</button>
                                </form>
                                <h4><a href="/deleteComment/<%=postDetail._id%>/<%=comments._id%>">Delete Comment</a></h4>
                                <h4>Replies</h4>
                                <%const commentReplies = comments.reply;%>
                                <%commentReplies.forEach(function(replies){%>
                                        <%=replies.username%>
                                        <br/>
                                        <%=replies.date%>
                                        <br/>
                                        <%=replies.reply%>
                                        <br/>
                                        <br/>
                                        <h4>Edit Reply</h4>
                                <form action="/editReply/<%=postDetail._id%>" method="post" autocomplete="off">
                                    <input type="text" name="editedReply">
                                    <input type="hidden" name="replyId" value="<%=replies._id%>">
                                    <input type="hidden" name="commentId" value="<%=comments._id%>">
                                    <button type="submit">Edit</button>
                                </form>
                                <h4><a href="/deleteReply/<%=postDetail._id%>/<%=comments._id%>/<%=replies._id%>">Delete Reply</a></h4>
                                    <%});%>
                                <form action="/reply/<%=postDetail._id%>" method="post" autocomplete="off">
                                    <input type="text" name="reply">
                                    <input type="hidden" name="commentId" value="<%=comments._id%>">
                                    <button type="submit">reply</button>
                                </form>
                            </div>
                        <br/><br/>
                        <%});%>
                <form action="/comment/<%=postDetail._id%>" method="post" autocomplete="off">
                    <input type="text" name="comment">
                    <button type="submit">Comment</button>
                </form>
           

          
        

<%} else if(typeof postDetail === "undefined") {%>
  <h2><%=errorMsg%></h2>
<%}%>
    
<%-include("partials/footer")-%>